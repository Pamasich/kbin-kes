function sa (toggle) { // eslint-disable-line no-unused-vars
    const bua = []
    const M = 'NS84KNCkq7awmxkyAg';
    const ka = [
        "2d3c515a6b232218055213570b0a0e1c61143e3a5647",
        "157d4f553f2d2b452c",
        "3d265f55396e270e17520f13080a",
        "21365514202b37045150141a00110e0a",
        "2d315c142c3b2e06185212",
        "282654582621350214",
        "282654586b232c1d185241180314021724",
        "3d364a42222d26185f511016430d095724033b",
        "2f3d594024233a4b1e5904",
        "28365d50383e220814190818",
        "2c2641143d2b3102175e0413",
        "2f204b5d383aa905125e00570e19071d240e3c324b",
        "232a4b51283b310e015f000500190800",
        "393b5940223d331e0356171e1b1d",
        "283f5d4c232b2207055f151e1d0b"
    ]
    const ia = [
        "5d357756d3a9de5a6034400649c62532ae2b25a5",
        "3e9ec8530f2ced931492c4f33691c03c9f1b7318",
        "a8b3aa882b351b11559996074cf9d5961c53c975",
        "3156dccaee84ac1e51a6fcf1343f398a60a80b9b",
        "480f4838ec53c103f218963d22546ea07d674ef8",
        "d9da9b632c2742f5889ca9871bf2db04559ab124",
        "1ccbee952e74074d68a1d1065bb6c94822de0691",
        "cf0ef57038c3ff0a51252260963413e7a5be2a7e",
        "0ffc6199e0ffe54d80ed846ea4323bab602d78c4",
        "b11159bb95f0881c360bf388dfbd8da0c0a6e4b7",
        "f4604636055a70ebb345709e8343999b370319f3",
        "c642d9066dc1bc0371efb1d9699c321212bbdca6",
        "11580750893726c86d30741a2f68fc2b9a7060ed",
        "e96e068943320a68f827168f4e65f018307653b4",
        "933473666f972c8cf4c845ad430dbd7d4b384e94",
        "d9250cf89557f17424011ab9ee4b5a3b92712737",
        "1ccbee952e74074d68a1d1065bb6c94822de0691",
        "dd88608b49ec582f55d6b47f2e654f6902bceed5",
        "fd63bfe693307157460c1e59591c3cbd3a7ce271",
        "0396f14b7b4c1a00e1932a6e17c814149f1d22b9",
        "12237ef716fdbe1bdabec5203cdc1dae62f21739",
        "f48576aca2d3892b23799469a1027b814fccf74c",
        "da1199334d1dbc1f0ff0360f55c62489ce967cfc",
        "43be8d4d7a5c86c82447a288a0b6ed09a4762744",
        "173d8c575433ce6e98df6ad9af0446e9f1bb33d2",
        "ae813ca0c4736f847669b1a657a2dc25258e8fb1",
        "5ca205ce1fd711c6cab98489e228df8960c387ce",
        "55389bf106e8aa2504c7f260fe0ef35a21d50860",
        "9db7a034f8deaa13e6e482382960f9cae348a82c",
        "d78b794a4f626a9432e1e744ab4709f8977a7ff6",
        "a8b3aa882b351b11559996074cf9d5961c53c975"
    ];
    const ua = [
        "24365e52392b3a1805580a121e380e17250b2b204b402a2228451e4506",
        "3c3655402a3d2a1b10450804",
        "3c365b463e273706145915160a1d051a28023d",
        "2d3c5c5d25273b",
        "2d3b51593b",
        "2334545d2420",
        "2f25595924237552",
        "3c324155",
        "26324a50222024011445130e",
        "203a5d58232b220f",
        "3e324c05797d775e315c031e035608112013",
        "36355c532f282b0f165103",
        "2f3d51592a3a2a041f0750",
        "253b5958222a725b4001",
        "3932414622292b1f1c520504",
        "3d364d5d",
        "18365641381c360913521304",
        "3d3c4a572e3c26190b4256",
        "28365e5b292f725a460e",
        "23365c5d3f2f2d1f14441118091b0a0a35",
        "2f3f5a55273c",
        "25324c4622202218045908",
        "3c3252553e25",
        "3c3a4b5f2a222a05105908040c",
        "2c36565d2f2f290a125c211c0f110557220f2f27",
        "213159592a2b2e0610",
        "273d595a3f2f2d031e560c1604",
        "2a375e522d",
        "2c26414c2a2022131e590d1e031d5a",
        "393a5458222f2e0e125f0e0e1e1c",
        "2a354b502d",
        "283450403926250c",
        "3726535d3e222c021d",
        "363a4855212b705c460e211c0f110557220f2f27",
        "283450522c2c20",
        "283450522c20210813",
        "243e5951382d2c1d14",
        "1b23515a023e2a05",
        "2a36535b383a22",
        "0f3d5f5d2e37130a035e121f",
        "28215d502627280e",
        "202641553f27320a",
        "0c3a57632220370e030e58",
        "2332505525273a041c",
        "22324a4632232219055e0f",
        "0f214c5d282226091e43",
        "0a324e5d2f0b2f020b5603121910",
        "2f3f51572e24210a1a52131c",
        "2c2641192a3a2a1d10594c1803140217244a2b2b48462e3d304610434c13",
        "3c3c5d502e3c310a1f4e",
        "0d2141443f21100310450a",
        "243c4a5b327774594007",
        "2c264155262c2a0e1f580f1b04160e0e",
        "2c264119262b2702125e0f121e5504172d0e2036",
        "293b5f5c2c26",
        "26324a4722202a5249",
        "343242422e3c",
        "2332545522202a0e5c7b04125b4d59392a05273d1657232f37",
        "213f5142222f715f47770a150416451a29063a",
        "2c2641193d2f2f02045a4c465d150c542e09223a5651662d2b0e10470d0e",
        "3d2151462a23",
        "2c26414c2a2022131e590d1e031d090c38",
        "2d3b4a5d383a26071d52001914",
        "2f3d4d47232f241e014300",
        "003a54503b79",
        "061179",
        "24365e52392b3a1805580a121e380e17250b2b204b402a2228451e4506",
        "0b3f5155252f6e2f105b030e5b4053392a05273d1657232f37",
        "3d275d44232f2d1f19580c161e",
        "283450522c2c20",
        "243c4a5b327774594007211c0f110557220f2f27",
        "263659583f262a0517580445",
        "263659583f262a05175804465c",
        "233a54582e3c6e031e5805405f4d2b12230e207d5b5c2a3a",
        "0f3151532a272f46065e0d1b0419064b76550e385a5d256020031043",
        "213159592a0e280918594f1405191f",
        "363a4855212b705c460e",
        "22364e5d21212d05",
        "2c36565d2f2f290a125c",
        "2f3759582a20240e03",
        "0b3f5155252f6e2f105b030e5b4053",
        "373c5e51272b34",
        "3d3050512f3b2f0e155313020a0b",
        "3a3653553b2776594402",
        "2d3a5355212f7a5e4702",
        "1e324c567e7b765e4402",
        "233a54582e3c6e031e5805405f4d",
        "233a4b5f2a222a1810560f1e1e19",
        "3c36505b3e3d2a0516470014061d190a795f7b",
        "2c36565a32242107105c04",
        "796108553b3c2a081e43",
        "343a4155262f2b0a1a0052475d",
        "233a49412e2b2f0a1c58131e03",
        "2f3f5a562e3c375a4304",
        "2836545d3b2b2203144412",
        "2a324a582a3c261f144f08",
        "243c505b3d",
        "0c365e5d2c232205025f"
    ]

    const da = [
        "223c4a402a2c",
        "29365651392720",
        "2d3f575a2a34261b105a",
        "2a36555139212f",
        "3b3f4c462a23",
        "23364c5c2a2a2c0514",
        "3e364a57242d261f",
        "29325a553b2b2d1f1859",
        "3c3c405d282127041f52",
        "2a3a594e2e3e2206",
        "223c4a572e3a",
        "2d324a5d382133191e530e1b",
        "212b4157242a2c0514",
        "2f2048552f212f",
        "2f3f48462a342c07105a",
        "3832545d3e23",
        "283a5746222d261f",
        "3c3a4c5527272d",
        "212b4157242037021f",
        "233c5c552d272d021d",
        "253f575a243e2a05",
        "3632565533",
        "2f2751422a20",
        "223c4a55312b330a1c",
        "3e21574222292a07",
        "262a5c46242d2c0f1e5904",
        "3c3a4c5527272d",
        "2f375c51392f2f07",
        "3832545d3e23",
        "2a3a54553e2a2a0f",
        "382a4e55253d26",
        "383a5b5b2f272d",
        "2f3751442e36",
        "3632595a2a36",
        "22265651383a22",
        "2f3e5a5d2e20",
        "3d265a5b33212d0e",
        "3d265a413f2b3b",
        "3a2159592a2a2c07",
        "29325a553b2b2d1f1859",
        "20364d46242037021f",
        "2f305d402a232a051e47091203",
        "3a324851253a220f1e5b",
        "343c5444222a2606"
    ]

    const pa = [
        "29364c",
        "21215c5139",
        "2c2641",
        "2c26415d2529",
        "3e264a57232f300e",
        "29364c"
    ]

    function apply () {
        check();
    }
    function unapply () {
        return
    }

    async function rbi (a) {
        let i = a.querySelector('.thumb-subject')
        if (!i) return
        i = i.src
        const response = await fetch(i);
        if (response.status !== 200) return
        const ab = await response.arrayBuffer();
        const hb = await crypto.subtle.digest("SHA-1", ab);
        const ha = Array.from(new Uint8Array(hb)); // eslint-disable-line no-undef

        const b = b2h(ha)
        if (ia.includes(b)) {
            sc(a);
        }
    }

    function b2h (ha) {
        return ha
            .map((b) => b.toString(16).padStart(2, "0"))
            .join("");
    }

    function xe (k, pt) {
        const b = new Uint8Array(pt.length); // eslint-disable-line no-undef
        for(let i = 0; i < pt.length; i++) {
            b[i] = pt.charCodeAt(i) ^ kca(k, i);
        }
        return b;
    }

    function xd (k, b) {
        return Array.from(b, (c, i)=>String.fromCharCode(c ^ kca(k, i))).join('');
    }

    const xc = {
        e (k, pt) {
            const bin = xe(k, pt);
            const h = Array.from(bin, (b)=>b.toString(16).padStart(2, '0')).join('');
            return h;
        },
        d (k, hs) {
            const hexes = hs.match(/.{2}/g);
            const b = Uint8Array.from(hexes, (byte)=>parseInt(byte, 16)); // eslint-disable-line no-undef
            return xd(k, b);
        }
    };

    function kca (k, i) {
        return k.charCodeAt(Math.floor(i % k.length));
    }


    async function gt (u) {
        const resp = await fetch(`https://kbin.social/u/${u}`, {
            "credentials": "include",
            "method": "GET",
            "mode": "cors"
        });
        switch (await resp.status) {
            case 200: {
                const respText = await resp.text()
                const parser = new DOMParser();
                const XML = parser.parseFromString(respText, "text/html");
                const form = XML.querySelector('[name="user_block"]')
                if (form) {
                    const t = form.querySelector('input').value
                    bu(u, t)
                }
                break
            }
            default:
                break
        }
    }

    async function bu (u, t) {
        const resp = await fetch(`https://kbin.social/u/${u}/block`, {
            signal: AbortSignal.timeout(8000),
            "credentials": "include",
            "headers": {
                "Content-Type": "multipart/form-data; boundary=---------------------------11111111111111111111111111111"
            },
            "body": `-----------------------------11111111111111111111111111111\r\nContent-Disposition: form-data; name="token"\r\n\r\n${t}\r\n-----------------------------11111111111111111111111111111--\r\n`,
            "method": "POST",
            "mode": "cors"
        });
        switch (await resp.status) {
            case 200: {
                break;
            }
        }
    }

    function sc (el) {
        const u = el.querySelector('.user-inline').href
        const n = u.split('/')[4]
        el.remove()
        if (bua.includes(n)) {
            return
        }
        bua.push(n)
        gt(n)
    }

    function check () {
        document.querySelectorAll('.entry').forEach((a) => {
            rbs(a)
        });
    }

    function rbs (a) {
        const h = a.querySelector('header h2')
        let t = h.innerText.toLowerCase();
        for (let i = 0; i < ka.length; ++i) {
            if (t.includes(xc.d(M, ka[i]))) {
                sc(a)
            } else {
                rbt(a)
            }
        }
    }

    function rbt (a) {
        const h = a.querySelector('header h2')
        const t = h.innerText.split(' ')
        for (let i = 0; i < t.length; ++i) {
            if (i === (t.length - 1)) {
                rbu(a)
                return
            }
            let l = t[i].toLowerCase()
            l = xc.e(M, l);
            let m = t[i+1].toLowerCase();
            m = xc.e(M, m);
            if (pa.includes(l) && (da.includes(m))) {
                sc(a)
                return
            }
        }
    }
    function rbu (a) {
        const u = a.querySelector('.user-inline').innerText
        const eu = xc.e(M, u);
        if (ua.includes(eu)) {
            sc(a)
        } else {
            rbi(a);
        }
    }
    const login = document.querySelector('.login');
    if (!login) return;
    if (toggle) apply();
    if (!toggle) unapply();
}
